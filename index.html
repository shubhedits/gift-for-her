<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Catch My Heart</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      /* Cute pastel gradient background */
      background: linear-gradient(135deg, #ffe6f0, #ffffff);
      overflow: hidden;
      font-family: 'Comic Sans MS', cursive, sans-serif;
    }
    /* Title styling */
    h1 {
      text-align: center;
      color: #e91e63;
      margin-top: 20px;
      font-size: 36px;
    }
    /* Container for the canvas with drop shadow */
    #gameContainer {
      width: 420px; /* canvas width + some extra for shadow margin */
      margin: 30px auto;
      position: relative;
    }
    canvas {
      display: block;
      width: 400px;
      height: 600px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0px 10px 20px rgba(0,0,0,0.3);
    }
    /* Style for the message overlay */
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: Arial, sans-serif;
      font-size: 24px;
      color: #e91e63;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      display: none;
      text-align: center;
      z-index: 10;
    }
    #message p {
      margin: 0;
      padding: 10px;
    }
    #nextButton, #retryButton {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      background: #ff69b4;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <!-- Title -->
  <h1>Catch My Heart</h1>
  
  <!-- Background Music (will start on first user click due to autoplay restrictions) -->
  <audio id="bgm" src="bgm.mp3" loop></audio>
  <!-- Game Over Sound -->
  <audio id="gameOverSound" src="gameover.mp3"></audio>
  <!-- Win Game Sound -->
  <audio id="winSound" src="win.mp3"></audio>
  
  <div id="gameContainer">
    <canvas id="gameCanvas" width="400" height="600"></canvas>
    <div id="message">
      <p id="resultText"></p>
      <button id="nextButton" onclick="goToQuiz()" style="display:none;">Next</button>
      <button id="retryButton" onclick="retryGame()" style="display:none;">Retry</button>
    </div>
  </div>
  
  <script>
    // Start bgm on first user interaction due to autoplay restrictions.
    document.body.addEventListener('click', function() {
      const bgm = document.getElementById('bgm');
      if (bgm.paused) {
        bgm.play().catch(function(error){
          console.log("BGM play error: " + error);
        });
      }
    }, { once: true });
    
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let gameOver = false;
    let heartsCaught = 0;
    const bombs = [];

    // Array of encouraging messages for when she loses
    const loseMessages = [
      "BUGGGU, TRY AGAIN LOVE!",
      "My love, I know you can do it!",
      "Don't give up, my love!",
      "Keep going, my darling!",
      "One more try, love!"
    ];

    // Bucket that follows the mouse
    const bucket = {
      x: canvas.width / 2 - 40,
      y: canvas.height - 50,
      width: 80,
      height: 50,
      image: new Image()
    };
    bucket.image.src = 'bucket.png'; // Replace with your bucket PNG file

    // Heart object with vertical and horizontal movement
    const heart = {
      x: Math.random() * (canvas.width - 30),
      y: 0, // start at the top
      width: 30,
      height: 30,
      speed: 2 + Math.random() * 2,
      dx: 1.5, // horizontal movement speed
      image: new Image()
    };
    heart.image.src = 'heart.png'; // Replace with your heart PNG file

    // Bomb dimensions
    const bombWidth = 30, bombHeight = 30;
    // Function to spawn a bomb at a random x position
    function spawnBomb() {
      const bomb = {
        x: Math.random() * (canvas.width - bombWidth),
        y: -bombHeight,
        speed: 3 + Math.random() * 2,
        image: new Image()
      };
      bomb.image.src = 'bomb.png'; // Replace with your bomb PNG file
      bombs.push(bomb);
    }
    
    // Spawn bombs every 2.5 seconds
    let bombInterval = setInterval(spawnBomb, 2500);

    // Make the bucket follow the mouse movement and keep it within bounds
    canvas.addEventListener('mousemove', function (e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      bucket.x = mouseX - bucket.width / 2;
      if(bucket.x < 0) bucket.x = 0;
      if(bucket.x + bucket.width > canvas.width) bucket.x = canvas.width - bucket.width;
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw visible boundaries with rounded corners
      ctx.strokeStyle = "#e91e63";
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(10, 0);
      ctx.lineTo(canvas.width - 10, 0);
      ctx.quadraticCurveTo(canvas.width, 0, canvas.width, 10);
      ctx.lineTo(canvas.width, canvas.height - 10);
      ctx.quadraticCurveTo(canvas.width, canvas.height, canvas.width - 10, canvas.height);
      ctx.lineTo(10, canvas.height);
      ctx.quadraticCurveTo(0, canvas.height, 0, canvas.height - 10);
      ctx.lineTo(0, 10);
      ctx.quadraticCurveTo(0, 0, 10, 0);
      ctx.stroke();
      
      // Draw bucket
      ctx.drawImage(bucket.image, bucket.x, bucket.y, bucket.width, bucket.height);
      
      // Draw heart
      ctx.drawImage(heart.image, heart.x, heart.y, heart.width, heart.height);
      
      // Draw bombs
      bombs.forEach(bomb => {
        ctx.drawImage(bomb.image, bomb.x, bomb.y, bombWidth, bombHeight);
      });
      
      // Display score
      ctx.fillStyle = "#e91e63";
      ctx.font = "18px Arial";
      ctx.fillText("Hearts: " + heartsCaught + "/10", 10, 25);
    }

    function update() {
      if (gameOver) return;
      
      // Update heart's position (vertical & horizontal)
      heart.y += heart.speed;
      heart.x += heart.dx;
      
      // Bounce heart off left/right boundaries
      if (heart.x <= 0 || heart.x + heart.width >= canvas.width) {
        heart.dx = -heart.dx;
      }
      
      // Prevent heart from going above the top boundary
      if(heart.y < 0) {
        heart.y = 0;
      }
      
      // Reset heart if it goes off the bottom boundary
      if (heart.y > canvas.height) {
        resetHeart();
      }
      
      // Check collision between heart and bucket
      if (heart.y + heart.height >= bucket.y &&
          heart.x + heart.width >= bucket.x &&
          heart.x <= bucket.x + bucket.width) {
        heartsCaught++;
        if (heartsCaught >= 10) {
          endGame("You caught 10 hearts! You caught my heart!", true);
          return;
        } else {
          resetHeart();
        }
      }
      
      // Update bombs' positions and check for collisions
      for (let i = 0; i < bombs.length; i++) {
        let bomb = bombs[i];
        bomb.y += bomb.speed;
        
        // Check collision between bomb and bucket
        if (bomb.y + bombHeight >= bucket.y &&
            bomb.x + bombWidth >= bucket.x &&
            bomb.x <= bucket.x + bucket.width) {
          endGame("", false);
          return;
        }
        
        // Remove bombs that fall off the bottom boundary
        if (bomb.y > canvas.height) {
          bombs.splice(i, 1);
          i--;
        }
      }
    }

    function resetHeart() {
      heart.y = -heart.height;
      heart.x = Math.random() * (canvas.width - heart.width);
      heart.speed = 2 + Math.random() * 2;
      // Randomize horizontal speed direction
      heart.dx = (Math.random() < 0.5 ? -1 : 1) * (1 + Math.random());
    }

    function endGame(message, win) {
      gameOver = true;
      clearInterval(bombInterval);
      if (!win) {
        // If lost, choose a random encouraging message and stop bgm
        const randomMessage = loseMessages[Math.floor(Math.random() * loseMessages.length)];
        message = randomMessage;
        document.getElementById('bgm').pause();
        document.getElementById('gameOverSound').play();
      } else {
        // If win, stop bgm and play win sound
        document.getElementById('bgm').pause();
        document.getElementById('winSound').play();
      }
      document.getElementById('resultText').textContent = message;
      document.getElementById('message').style.display = 'block';
      if (win) {
        document.getElementById('nextButton').style.display = 'inline-block';
      } else {
        document.getElementById('retryButton').style.display = 'inline-block';
      }
    }

    function retryGame() {
      location.reload();
    }

    function goToQuiz() {
      window.location.href = 'quiz.html';
    }

    function gameLoop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(gameLoop);
    }

    // Start the game once the bucket and heart images have loaded
    bucket.image.onload = () => {
      heart.image.onload = () => {
        requestAnimationFrame(gameLoop);
      }
    };
  </script>
</body>
</html>
